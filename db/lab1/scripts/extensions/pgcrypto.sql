-- ========================================
-- –†–∞–±–æ—Ç–∞ —Å pgcrypto: —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
-- ========================================

-- 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- 2. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö—ç—à–∞ –ø–∞—Ä–æ–ª—è
ALTER TABLE users ADD COLUMN IF NOT EXISTS password_hash TEXT;

-- 3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ö—ç—à –ø–∞—Ä–æ–ª—è
UPDATE users
SET
    password_hash = crypt (
        'super_secure_password',
        gen_salt ('bf')
    )
WHERE
    email = 'MatthewAnderson1@gmail.com';

-- 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
SELECT email
FROM users
WHERE
    email = 'MatthewAnderson1@gmail.com'
    AND password_hash = crypt (
        'super_secure_password',
        password_hash
    );

-- üìå –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
-- - –ü–∞—Ä–æ–ª–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.
-- - –°–æ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
-- - –£—Å—Ç–æ–π—á–∏–≤–æ –∫ –∞—Ç–∞–∫–∞–º —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ë–î-–∞–¥–º–∏–Ω–∞.

-- –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: digest('text', 'sha256') –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ö—ç—à–∞ –±–µ–∑ —Å–æ–ª–∏.